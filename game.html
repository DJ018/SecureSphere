<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SecureSphere | Cyber Security Games</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Inter:wght@400;500;600&display=swap"
    rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      background: linear-gradient(135deg, #0B0F1A 0%, #1a1f35 100%);
      color: #fff;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 70px;
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(34, 211, 238, 0.2);
      position: sticky;
      top: 0;
      z-index: 1000;
      animation: slideDown 0.5s ease;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .brand {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #22d3ee, #10b981);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 26px;
    }

    nav ul li a {
      text-decoration: none;
      color: #94a3b8;
      font-weight: 500;
      font-size: 15px;
      transition: all 0.3s ease;
      position: relative;
      padding: 5px 0;
    }

    nav ul li a:hover {
      color: #22d3ee;
    }

    nav ul li a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #22d3ee, #06b6d4);
      transition: width 0.3s ease;
    }

    nav ul li a:hover::after {
      width: 100%;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 60px 40px;
    }

    .section {
      opacity: 0;
      transform: translateY(40px);
      animation: fadeInUp 0.8s forwards;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1,
    h2,
    h3 {
      font-family: 'Orbitron', sans-serif;
    }

    h1 {
      font-size: 3rem;
      font-weight: 900;
      text-align: center;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #22d3ee, #06b6d4, #10b981);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 200% 200%;
      animation: gradientShift 3s ease infinite;
    }

    @keyframes gradientShift {

      0%,
      100% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }
    }

    h2 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 30px;
      text-align: center;
      background: linear-gradient(135deg, #22d3ee, #06b6d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .input-group {
      text-align: center;
      margin: 40px 0;
    }

    input[type="text"] {
      padding: 16px 24px;
      width: 100%;
      max-width: 400px;
      border-radius: 12px;
      border: 2px solid #334155;
      background: rgba(30, 41, 59, 0.5);
      color: #fff;
      font-size: 16px;
      transition: all 0.3s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #00e5ff;
      box-shadow: 0 0 20px rgba(0, 229, 255, 0.3);
    }

    button {
      padding: 16px 32px;
      background: linear-gradient(135deg, #00e5ff, #00ff9c);
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 16px;
      color: #0B0F1A;
      cursor: pointer;
      transition: all 0.3s;
      margin: 10px;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 229, 255, 0.4);
    }

    button.secondary {
      background: rgba(51, 65, 85, 0.8);
      color: #fff;
    }

    button.secondary:hover {
      background: rgba(71, 85, 105, 0.9);
      box-shadow: 0 10px 30px rgba(100, 116, 139, 0.3);
    }

    .games-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      margin: 40px 0;
    }

    .game-card {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
      padding: 40px 30px;
      border-radius: 20px;
      border: 2px solid rgba(34, 211, 238, 0.2);
      transition: all 0.4s;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      min-height: 350px;
    }

    .game-card:hover {
      transform: translateY(-10px);
      border-color: #22d3ee;
      box-shadow: 0 20px 40px rgba(34, 211, 238, 0.3);
    }

    .game-icon {
      font-size: 4rem;
      margin-bottom: 20px;
    }

    .game-card h3 {
      margin-bottom: 15px;
      color: #22d3ee;
      font-size: 1.3rem;
    }

    .game-card p {
      color: #94a3b8;
      margin-bottom: 25px;
      line-height: 1.6;
      flex-grow: 1;
    }

    .question-container {
      background: rgba(30, 41, 59, 0.6);
      padding: 40px;
      border-radius: 20px;
      margin: 30px 0;
      border: 2px solid rgba(0, 229, 255, 0.2);
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .question-number {
      background: linear-gradient(135deg, #00e5ff, #00ff9c);
      color: #0B0F1A;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 600;
    }

    .timer {
      background: rgba(51, 65, 85, 0.8);
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 600;
    }

    .question-text {
      font-size: 1.3rem;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .options-container {
      display: grid;
      gap: 15px;
    }

    .option {
      background: rgba(30, 41, 59, 0.8);
      padding: 20px;
      border-radius: 12px;
      border: 2px solid rgba(100, 116, 139, 0.5);
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
    }

    .option:hover:not(.disabled) {
      border-color: #00e5ff;
      background: rgba(30, 41, 59, 1);
      transform: translateX(5px);
    }

    .option.correct {
      background: linear-gradient(135deg, rgba(0, 255, 156, 0.2), rgba(0, 255, 156, 0.3));
      border-color: #00ff9c;
      animation: correctPulse 0.5s;
    }

    .option.wrong {
      background: linear-gradient(135deg, rgba(255, 77, 77, 0.2), rgba(255, 77, 77, 0.3));
      border-color: #ff4d4d;
      animation: wrongShake 0.5s;
    }

    .option.disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    @keyframes correctPulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.02);
      }
    }

    @keyframes wrongShake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-10px);
      }

      75% {
        transform: translateX(10px);
      }
    }

    .explanation {
      background: linear-gradient(135deg, rgba(0, 229, 255, 0.1), rgba(0, 255, 156, 0.1));
      border-left: 4px solid #00e5ff;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
      display: none;
    }

    .explanation.show {
      display: block;
      animation: fadeInUp 0.5s;
    }

    .explanation-icon {
      font-size: 1.5rem;
      margin-right: 10px;
    }

    .leaderboard {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 20px;
      padding: 40px;
      margin-top: 40px;
      border: 2px solid rgba(0, 229, 255, 0.2);
    }

    .leaderboard h3 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 1.8rem;
    }

    .leaderboard-list {
      list-style: none;
    }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: rgba(15, 23, 42, 0.6);
      margin-bottom: 10px;
      border-radius: 10px;
      border: 1px solid rgba(100, 116, 139, 0.3);
    }

    .leaderboard-rank {
      font-weight: 700;
      font-size: 1.2rem;
      color: #00e5ff;
      min-width: 40px;
    }

    .leaderboard-name {
      flex: 1;
      margin: 0 20px;
    }

    .leaderboard-score {
      font-weight: 600;
      color: #00ff9c;
    }

    .analysis-container {
      background: rgba(30, 41, 59, 0.6);
      padding: 50px;
      border-radius: 20px;
      border: 2px solid rgba(0, 229, 255, 0.2);
      text-align: center;
    }

    .score-display {
      font-size: 4rem;
      font-weight: 700;
      background: linear-gradient(135deg, #00e5ff, #00ff9c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 20px 0;
    }

    .performance-badge {
      display: inline-block;
      padding: 15px 30px;
      background: linear-gradient(135deg, rgba(0, 229, 255, 0.2), rgba(0, 255, 156, 0.2));
      border-radius: 30px;
      font-size: 1.5rem;
      margin: 20px 0;
      border: 2px solid #00e5ff;
    }

    .analysis-section {
      margin: 30px 0;
      text-align: left;
      background: rgba(15, 23, 42, 0.6);
      padding: 25px;
      border-radius: 12px;
    }

    .analysis-section h3 {
      color: #00e5ff;
      margin-bottom: 15px;
      text-align: left;
    }

    .analysis-section ul {
      list-style: none;
      padding-left: 0;
    }

    .analysis-section li {
      padding: 10px 0;
      padding-left: 30px;
      position: relative;
    }

    .analysis-section li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: #00ff9c;
      font-weight: 700;
    }

    .password-input-container {
      margin: 30px 0;
    }

    .password-input-container input {
      width: 100%;
      max-width: 100%;
      margin-bottom: 15px;
    }

    .strength-meter {
      height: 10px;
      background: rgba(100, 116, 139, 0.3);
      border-radius: 10px;
      overflow: hidden;
      margin: 15px 0;
    }

    .strength-meter-fill {
      height: 100%;
      transition: all 0.5s;
      border-radius: 10px;
    }

    .strength-feedback {
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
      margin: 15px 0;
    }

    .loading {
      text-align: center;
      padding: 40px;
    }

    .spinner {
      border: 4px solid rgba(100, 116, 139, 0.3);
      border-top: 4px solid #00e5ff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Threat Detection Card Game Styles */
    .threat-detection-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .threat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .threat-number {
      background: linear-gradient(135deg, #22d3ee, #10b981);
      color: #0B0F1A;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 600;
    }

    .threat-score {
      background: rgba(51, 65, 85, 0.8);
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 600;
    }

    .threat-card {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
      padding: 50px 40px;
      border-radius: 24px;
      border: 2px solid rgba(34, 211, 238, 0.3);
      text-align: center;
      margin-bottom: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .threat-icon-large {
      font-size: 5rem;
      margin-bottom: 20px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }
    }

    .threat-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.8rem;
      color: #22d3ee;
      margin-bottom: 20px;
      font-weight: 700;
    }

    .threat-scenario {
      font-size: 1.2rem;
      line-height: 1.8;
      color: #e5e7eb;
      margin-bottom: 40px;
      padding: 20px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 12px;
      border-left: 4px solid #22d3ee;
    }

    .threat-actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 30px;
    }

    .action-card {
      background: rgba(15, 23, 42, 0.6);
      padding: 30px 20px;
      border-radius: 16px;
      border: 2px solid rgba(100, 116, 139, 0.5);
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .action-card:hover {
      transform: translateY(-5px);
      border-color: #22d3ee;
      box-shadow: 0 10px 30px rgba(34, 211, 238, 0.3);
    }

    .action-card.safe:hover {
      border-color: #10b981;
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    }

    .action-card.suspicious:hover {
      border-color: #f59e0b;
      box-shadow: 0 10px 30px rgba(245, 158, 11, 0.3);
    }

    .action-card.dangerous:hover {
      border-color: #ef4444;
      box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
    }

    .action-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }

    .action-label {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: #e5e7eb;
    }

    .action-desc {
      font-size: 0.9rem;
      color: #94a3b8;
    }

    .threat-feedback {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
      padding: 30px;
      border-radius: 16px;
      border: 2px solid rgba(34, 211, 238, 0.3);
      margin-top: 20px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }

    .threat-feedback.show {
      opacity: 1;
      transform: translateY(0);
    }

    .feedback-content {
      text-align: center;
    }

    .feedback-icon {
      font-size: 4rem;
      margin-bottom: 15px;
    }

    .feedback-text {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .feedback-explanation {
      font-size: 1.1rem;
      line-height: 1.6;
      color: #94a3b8;
      padding: 15px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 8px;
    }

    @media (max-width: 768px) {
      .threat-actions {
        grid-template-columns: 1fr;
      }

      .action-card {
        padding: 20px 15px;
      }

      .threat-card {
        padding: 30px 20px;
      }
    }

    footer {
      background: rgba(18, 24, 41, 0.9);
      text-align: center;
      padding: 30px;
      margin-top: 60px;
      border-top: 2px solid rgba(0, 229, 255, 0.2);
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 768px) {
      nav {
        padding: 15px 20px;
        flex-wrap: wrap;
      }

      .brand {
        font-size: 20px;
      }

      nav ul {
        order: 3;
        width: 100%;
        justify-content: center;
        margin-top: 15px;
        gap: 15px;
        flex-wrap: wrap;
      }

      nav ul li a {
        font-size: 14px;
      }

      .container {
        padding: 40px 20px;
      }

      h1 {
        font-size: 2rem;
      }

      h2 {
        font-size: 1.6rem;
      }

      .games-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .game-card {
        padding: 25px;
      }

      .game-icon {
        font-size: 3rem;
      }

      .input-group input,
      .input-group button {
        font-size: 15px;
      }

      .quiz-option {
        padding: 12px 15px;
        font-size: 14px;
      }

      .threat-card {
        padding: 20px;
      }
    }

    @media (max-width: 480px) {
      nav {
        padding: 12px 15px;
      }

      .brand {
        font-size: 18px;
      }

      nav ul {
        gap: 10px;
      }

      nav ul li a {
        font-size: 13px;
      }

      .container {
        padding: 30px 15px;
      }

      h1 {
        font-size: 1.6rem;
      }

      h2 {
        font-size: 1.3rem;
      }

      .game-card {
        padding: 20px;
      }

      .game-icon {
        font-size: 2.5rem;
      }

      .game-card h3 {
        font-size: 1.2rem;
      }

      .game-card p {
        font-size: 14px;
      }

      .input-group input {
        padding: 12px 15px;
        font-size: 14px;
      }

      .input-group button,
      button {
        padding: 12px 20px;
        font-size: 14px;
      }

      .quiz-option {
        padding: 10px 12px;
        font-size: 13px;
      }

      .threat-card {
        padding: 15px;
      }

      .threat-icon-large {
        font-size: 3.5rem;
      }

      .threat-title {
        font-size: 1.4rem;
      }
    }
  </style>
</head>

<body>

  <nav>
    <div class="brand">SecureSphere</div>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="learn.html">Learn</a></li>
      <li><a href="services.html">Services</a></li>
      <li><a href="portfolio.html">Portfolio</a></li>
      <li><a href="lab.html">Labs</a></li>
      <li><a href="game.html">Games</a></li>
    </ul>
  </nav>

  <!-- NAME ENTRY SCREEN -->
  <div id="nameScreen" class="container section">
    <h1>üéÆ Cyber Security Games</h1>
    <p style="text-align: center; font-size: 1.2rem; color: #94a3b8; margin-bottom: 40px;">
      Test your cybersecurity knowledge through interactive games
    </p>
    <div class="input-group">
      <input type="text" id="usernameInput" placeholder="Enter your name to start">
      <br><br>
      <button onclick="enterGames()">Continue to Games</button>
    </div>
  </div>

  <!-- GAME SELECTION SCREEN -->
  <div id="gamesScreen" class="container section hidden">
    <h2>Choose Your Challenge</h2>
    <div class="games-grid">
      <div class="game-card">
        <div class="game-icon">üß†</div>
        <h3>Cyber Awareness Quiz</h3>
        <p>Test your knowledge of cybersecurity fundamentals with 12 challenging questions</p>
        <button onclick="startGame('quiz')">Start Quiz</button>
      </div>
      <div class="game-card">
        <div class="game-icon">üéØ</div>
        <h3>Threat Detection</h3>
        <p>Make critical security decisions in real-world scenario-based challenges</p>
        <button onclick="startGame('scenario')">Start Challenge</button>
      </div>
      <div class="game-card">
        <div class="game-icon">üîê</div>
        <h3>Password Strength Analyzer</h3>
        <p>Evaluate and learn what makes passwords secure or vulnerable</p>
        <button onclick="startGame('password')">Start Analyzer</button>
      </div>
    </div>

    <div class="leaderboard">
      <h3>üèÜ Top Players</h3>
      <ul class="leaderboard-list" id="leaderboardList">
        <li style="text-align: center; color: #64748b;">Loading leaderboard...</li>
      </ul>
    </div>
  </div>

  <!-- GAME SCREEN -->
  <div id="gameScreen" class="container section hidden">
    <button class="secondary" onclick="backToGames()">‚¨Ö Back to Games</button>
    <div id="gameContent"></div>
  </div>

  <!-- ANALYSIS SCREEN -->
  <div id="analysisScreen" class="container section hidden">
    <div class="analysis-container">
      <h2>Game Complete! üéâ</h2>
      <div id="analysisContent"></div>
      <button onclick="backToGames()">Play Another Game</button>
      <button class="secondary" onclick="viewLeaderboard()">View Leaderboard</button>
    </div>
  </div>

  <footer>
    ¬© 2024 SecureSphere | Educate ‚Ä¢ Defend ‚Ä¢ Secure
  </footer>

  <script>
    const API_URL = '';

    // Sound effects
    const correctSound = new Audio('https://assets.mixkit.co/active/mixkit-achievement-bell-600.mp3');
    const wrongSound = new Audio('https://assets.mixkit.co/active/mixkit-wrong-answer-fail-notification-946.mp3');

    // Game state
    let currentUser = '';
    let currentGameType = '';
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let startTime = null;
    let userAnswers = [];

    // Navigation functions
    function enterGames() {
      const username = document.getElementById('usernameInput').value.trim();
      if (!username) {
        alert('Please enter your name to continue');
        return;
      }
      currentUser = username;
      showScreen('gamesScreen');
      loadLeaderboard();
    }

    function showScreen(screenId) {
      const screens = ['nameScreen', 'gamesScreen', 'gameScreen', 'analysisScreen'];
      screens.forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(screenId).classList.remove('hidden');
    }

    function backToGames() {
      showScreen('gamesScreen');
      loadLeaderboard();
    }

    function viewLeaderboard() {
      showScreen('gamesScreen');
      document.querySelector('.leaderboard').scrollIntoView({ behavior: 'smooth' });
    }

    // Load leaderboard
    async function loadLeaderboard() {
      try {
        const response = await fetch(`${API_URL}/api/games/leaderboard`);
        const data = await response.json();

        const leaderboardList = document.getElementById('leaderboardList');

        // Handle both success response format and direct array
        const leaderboardData = data.success ? data.leaderboard : (Array.isArray(data) ? data : []);

        if (!leaderboardData || leaderboardData.length === 0) {
          leaderboardList.innerHTML = '<li style="text-align: center; color: #64748b;">No scores yet. Be the first!</li>';
          return;
        }

        leaderboardList.innerHTML = leaderboardData.map((entry, index) => `
      <li class="leaderboard-item">
        <span class="leaderboard-rank">#${index + 1}</span>
        <span class="leaderboard-name">${entry.playerName || entry.username || 'Anonymous'}</span>
        <span class="leaderboard-score">${entry.score}/${entry.totalQuestions || 10} (${Math.round((entry.score / (entry.totalQuestions || 10)) * 100)}%)</span>
      </li>
    `).join('');
      } catch (error) {
        console.error('Error loading leaderboard:', error);
        document.getElementById('leaderboardList').innerHTML = `
          <li style="text-align: center; color: #94a3b8; padding: 20px;">
            <div style="margin-bottom: 10px;">üìä</div>
            Leaderboard temporarily unavailable<br>
            <small style="color: #64748b;">Your scores will still be saved when you play!</small>
          </li>
        `;
      }
    }

    // Start game
    async function startGame(gameType) {
      currentGameType = gameType;
      currentQuestionIndex = 0;
      score = 0;
      userAnswers = [];
      startTime = Date.now();

      showScreen('gameScreen');
      document.getElementById('gameContent').innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading questions...</p></div>';

      try {
        const response = await fetch(`${API_URL}/api/games/questions/${gameType}?count=10`);
        const data = await response.json();
        questions = data.questions;

        if (gameType === 'password') {
          showPasswordGame();
        } else {
          showQuestion();
        }
      } catch (error) {
        console.error('Error loading questions:', error);
        document.getElementById('gameContent').innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <div style="font-size: 4rem; margin-bottom: 20px;">‚ö†Ô∏è</div>
            <h2 style="color: #ff9d4d; margin-bottom: 20px;">Unable to Load Game</h2>
            <p style="color: #94a3b8; font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px;">
              The game backend is currently unavailable. This could be because:
            </p>
            <div style="text-align: left; max-width: 600px; margin: 0 auto 30px; background: rgba(30, 41, 59, 0.6); padding: 25px; border-radius: 12px;">
              <p style="margin-bottom: 15px;">üåê <strong>Testing Locally?</strong> The games only work when deployed to Vercel.</p>
              <p style="margin-bottom: 15px;">üîÑ <strong>Just Deployed?</strong> Wait 1-2 minutes for the API to initialize.</p>
              <p style="margin-bottom: 0;">üì° <strong>Network Issue?</strong> Check your internet connection and try again.</p>
            </div>
            <button onclick="location.reload()" style="margin-right: 10px;">üîÑ Retry</button>
            <button class="secondary" onclick="backToGames()">‚¨Ö Back</button>
          </div>
        `;
      }
    }

    // Show question for quiz and scenario games
    function showQuestion() {
      if (currentQuestionIndex >= questions.length) {
        finishGame();
        return;
      }

      const question = questions[currentQuestionIndex];
      const gameContent = document.getElementById('gameContent');

      // Different display for scenario (threat detection) vs quiz
      if (currentGameType === 'scenario') {
        showThreatDetectionCard();
      } else {
        // Standard quiz format
        gameContent.innerHTML = `
      <div class="question-container">
        <div class="question-header">
          <span class="question-number">Question ${currentQuestionIndex + 1} of ${questions.length}</span>
          <span class="timer">Score: ${score}/${currentQuestionIndex}</span>
        </div>
        <div class="question-text">${question.question}</div>
        <div class="options-container" id="optionsContainer">
          ${question.options.map((option, index) => `
            <div class="option" onclick="selectAnswer(${index})">
              ${option}
            </div>
          `).join('')}
        </div>
        <div class="explanation" id="explanation">
          <span class="explanation-icon">üí°</span>
          <strong>Explanation:</strong> <span id="explanationText"></span>
        </div>
      </div>
    `;
      }
    }

    // Threat Detection Card Game
    function showThreatDetectionCard() {
      const threat = questions[currentQuestionIndex];
      const gameContent = document.getElementById('gameContent');

      // Determine threat type icon
      const threatIcons = {
        0: 'üìß', // Email/Phishing
        1: 'üíæ', // USB/Device
        2: 'üìû', // Phone/Social Engineering
        3: '‚ö†Ô∏è'  // Alert/Warning
      };
      const iconIndex = currentQuestionIndex % 4;

      gameContent.innerHTML = `
        <div class="threat-detection-container">
          <div class="threat-header">
            <span class="threat-number">Alert ${currentQuestionIndex + 1} of ${questions.length}</span>
            <span class="threat-score">Score: ${score}/${currentQuestionIndex}</span>
          </div>
          
          <div class="threat-card">
            <div class="threat-icon-large">${threatIcons[iconIndex]}</div>
            <div class="threat-title">Security Alert</div>
            <div class="threat-scenario">${threat.question}</div>
            
            <div class="threat-actions">
              <div class="action-card safe" onclick="classifyThreat(0)">
                <div class="action-icon">‚úÖ</div>
                <div class="action-label">Safe</div>
                <div class="action-desc">No threat detected</div>
              </div>
              <div class="action-card suspicious" onclick="classifyThreat(1)">
                <div class="action-icon">‚ö†Ô∏è</div>
                <div class="action-label">Report</div>
                <div class="action-desc">Needs investigation</div>
              </div>
              <div class="action-card dangerous" onclick="classifyThreat(2)">
                <div class="action-icon">üö´</div>
                <div class="action-label">Block</div>
                <div class="action-desc">Immediate threat</div>
              </div>
            </div>
          </div>
          
          <div class="threat-feedback hidden" id="threatFeedback">
            <div class="feedback-content">
              <div class="feedback-icon" id="feedbackIcon"></div>
              <div class="feedback-text" id="feedbackText"></div>
              <div class="feedback-explanation" id="feedbackExplanation"></div>
            </div>
          </div>
        </div>
      `;
    }

    // Classify threat in card game
    function classifyThreat(userChoice) {
      const threat = questions[currentQuestionIndex];
      const feedback = document.getElementById('threatFeedback');
      const feedbackIcon = document.getElementById('feedbackIcon');
      const feedbackText = document.getElementById('feedbackText');
      const feedbackExplanation = document.getElementById('feedbackExplanation');
      const actionCards = document.querySelectorAll('.action-card');

      // Disable all action cards
      actionCards.forEach(card => card.style.pointerEvents = 'none');

      // The correct answer is stored in threat.correct
      const isCorrect = userChoice === threat.correct;

      if (isCorrect) {
        feedbackIcon.textContent = 'üéâ';
        feedbackText.textContent = 'Correct Decision!';
        feedbackText.style.color = '#10b981';
        actionCards[userChoice].style.border = '3px solid #10b981';
        actionCards[userChoice].style.background = 'rgba(16, 185, 129, 0.2)';
        score++;
        correctSound.play();
      } else {
        feedbackIcon.textContent = '‚ùå';
        feedbackText.textContent = 'Incorrect Decision';
        feedbackText.style.color = '#ff4d4d';
        actionCards[userChoice].style.border = '3px solid #ff4d4d';
        actionCards[userChoice].style.background = 'rgba(255, 77, 77, 0.2)';
        actionCards[threat.correct].style.border = '3px solid #10b981';
        actionCards[threat.correct].style.background = 'rgba(16, 185, 129, 0.2)';
        wrongSound.play();
      }

      feedbackExplanation.textContent = threat.explanation;
      feedback.classList.remove('hidden');
      feedback.classList.add('show');

      // Store answer
      userAnswers.push({
        question: threat.question,
        selected: userChoice,
        correct: threat.correct,
        isCorrect
      });

      // Move to next after delay
      setTimeout(() => {
        currentQuestionIndex++;
        showQuestion();
      }, 3500);
    }

    // Handle answer selection for quiz game
    function selectAnswer(selectedIndex) {
      const question = questions[currentQuestionIndex];
      const options = document.querySelectorAll('.option');
      const explanation = document.getElementById('explanation');
      const explanationText = document.getElementById('explanationText');

      // Disable all options
      options.forEach(option => option.classList.add('disabled'));

      // Check if answer is correct
      const isCorrect = selectedIndex === question.correct;

      if (isCorrect) {
        options[selectedIndex].classList.add('correct');
        score++;
        correctSound.play();
      } else {
        options[selectedIndex].classList.add('wrong');
        options[question.correct].classList.add('correct');
        wrongSound.play();
      }

      // Show explanation
      explanationText.textContent = question.explanation;
      explanation.classList.add('show');

      // Store answer
      userAnswers.push({
        question: question.question,
        selected: selectedIndex,
        correct: question.correct,
        isCorrect
      });

      // Move to next question after delay
      setTimeout(() => {
        currentQuestionIndex++;
        showQuestion();
      }, 3000);
    }

    // Password strength game
    function showPasswordGame() {
      if (currentQuestionIndex >= questions.length) {
        finishGame();
        return;
      }

      const passwordData = questions[currentQuestionIndex];
      const gameContent = document.getElementById('gameContent');

      gameContent.innerHTML = `
    <div class="question-container">
      <div class="question-header">
        <span class="question-number">Password ${currentQuestionIndex + 1} of ${questions.length}</span>
        <span class="timer">Score: ${score}/${currentQuestionIndex}</span>
      </div>
      <div class="question-text">Analyze this password: <code style="background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 5px;">${passwordData.password}</code></div>
      <div class="password-input-container">
        <div class="strength-meter">
          <div class="strength-meter-fill" id="strengthMeter"></div>
        </div>
        <div class="strength-feedback" id="strengthFeedback">Click "Analyze" to check strength</div>
        <button onclick="analyzePassword()">Analyze Password</button>
      </div>
      <div class="explanation hidden" id="explanation">
        <span class="explanation-icon">üí°</span>
        <strong>Feedback:</strong> <span id="explanationText"></span>
      </div>
    </div>
  `;
    }

    // Analyze password
    function analyzePassword() {
      const passwordData = questions[currentQuestionIndex];
      const strengthMeter = document.getElementById('strengthMeter');
      const strengthFeedback = document.getElementById('strengthFeedback');
      const explanation = document.getElementById('explanation');
      const explanationText = document.getElementById('explanationText');

      // Calculate strength percentage
      const strengthPercent = (passwordData.score / 4) * 100;

      // Update meter
      strengthMeter.style.width = strengthPercent + '%';

      // Set color based on strength
      let color;
      if (passwordData.score === 0) {
        color = '#ff4d4d';
        wrongSound.play();
      } else if (passwordData.score === 1) {
        color = '#ff9d4d';
        wrongSound.play();
      } else if (passwordData.score === 2) {
        color = '#ffeb3b';
      } else if (passwordData.score === 3) {
        color = '#4caf50';
        correctSound.play();
      } else {
        color = '#00ff9c';
        correctSound.play();
      }

      strengthMeter.style.background = color;
      strengthFeedback.textContent = `Strength: ${passwordData.strength}`;
      strengthFeedback.style.color = color;

      // Show explanation
      explanationText.textContent = passwordData.feedback;
      explanation.classList.remove('hidden');
      explanation.classList.add('show');

      // Award points for medium or better
      if (passwordData.score >= 2) {
        score++;
      }

      // Store answer
      userAnswers.push({
        password: passwordData.password,
        strength: passwordData.strength,
        score: passwordData.score
      });

      // Move to next after delay
      setTimeout(() => {
        currentQuestionIndex++;
        showPasswordGame();
      }, 3000);
    }

    // Finish game and show analysis
    async function finishGame() {
      const timeTaken = Math.round((Date.now() - startTime) / 1000);
      const percentage = Math.round((score / questions.length) * 100);

      // Generate analysis locally
      let performance, gameInsights;
      const strengths = [];
      const weaknesses = [];
      const recommendations = [];

      if (percentage >= 90) {
        performance = 'üèÜ Master';
        gameInsights = 'Outstanding performance! You have expert-level cybersecurity knowledge.';
        strengths.push('Excellent understanding of security concepts');
        strengths.push('Quick and accurate decision making');
        recommendations.push('Consider pursuing advanced certifications like CISSP or CEH');
      } else if (percentage >= 75) {
        performance = 'ü•á Expert';
        gameInsights = 'Great job! You have strong cybersecurity awareness.';
        strengths.push('Good grasp of fundamental security principles');
        if (percentage < 90) weaknesses.push('Some advanced concepts need review');
        recommendations.push('Review the learning modules for topics you missed');
      } else if (percentage >= 60) {
        performance = 'ü•à Proficient';
        gameInsights = 'Good work! You\'re building solid security knowledge.';
        strengths.push('Understanding basic security concepts');
        weaknesses.push('Need more practice with advanced scenarios');
        recommendations.push('Complete all learning modules to strengthen your knowledge');
        recommendations.push('Practice with more security labs');
      } else {
        performance = 'ü•â Learner';
        gameInsights = 'Keep learning! Cybersecurity is a journey.';
        weaknesses.push('Need to strengthen fundamental security concepts');
        weaknesses.push('More practice needed with threat identification');
        recommendations.push('Start with the Cyber Security Basics learning module');
        recommendations.push('Practice daily with security awareness content');
        recommendations.push('Join cybersecurity communities for continuous learning');
      }

      const analysis = {
        performance,
        percentage,
        gameInsights,
        strengths,
        weaknesses,
        recommendations
      };

      try {
        // Submit to backend
        const submitResponse = await fetch(`${API_URL}/api/games/submit`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            playerName: currentUser,
            gameType: currentGameType,
            score: score,
            totalQuestions: questions.length,
            answers: userAnswers,
            timeTaken: timeTaken
          })
        });

        // Add to leaderboard
        await fetch(`${API_URL}/api/games/leaderboard`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            playerName: currentUser,
            gameType: currentGameType,
            score: score,
            totalQuestions: questions.length,
            accuracy: percentage,
            timeSpent: timeTaken
          })
        });

        // Display analysis
        const analysisContent = document.getElementById('analysisContent');
        analysisContent.innerHTML = `
      <div class="score-display">${score}/${questions.length}</div>
      <div class="performance-badge">${analysis.performance}</div>
      <p style="font-size: 1.2rem; margin: 20px 0;">Percentage: ${analysis.percentage}%</p>
      <p style="color: #94a3b8; margin-bottom: 30px;">Time Taken: ${timeTaken} seconds</p>
      
      ${analysis.gameInsights ? `<p style="color: #00e5ff; margin-bottom: 20px;">${analysis.gameInsights}</p>` : ''}
      
      ${analysis.strengths.length > 0 ? `
        <div class="analysis-section">
          <h3>üí™ Strengths</h3>
          <ul>
            ${analysis.strengths.map(s => `<li>${s}</li>`).join('')}
          </ul>
        </div>
      ` : ''}
      
      ${analysis.weaknesses.length > 0 ? `
        <div class="analysis-section">
          <h3>üìö Areas for Improvement</h3>
          <ul>
            ${analysis.weaknesses.map(w => `<li>${w}</li>`).join('')}
          </ul>
        </div>
      ` : ''}
      
      ${analysis.recommendations.length > 0 ? `
        <div class="analysis-section">
          <h3>üéØ Recommendations</h3>
          <ul>
            ${analysis.recommendations.map(r => `<li>${r}</li>`).join('')}
          </ul>
        </div>
      ` : ''}
    `;

        showScreen('analysisScreen');
      } catch (error) {
        console.error('Error submitting game:', error);
        // Still show analysis even if submission fails
        const analysisContent = document.getElementById('analysisContent');
        analysisContent.innerHTML = `
      <div class="score-display">${score}/${questions.length}</div>
      <div class="performance-badge">${analysis.performance}</div>
      <p style="font-size: 1.2rem; margin: 20px 0;">Percentage: ${analysis.percentage}%</p>
      <p style="color: #94a3b8; margin-bottom: 30px;">Time Taken: ${timeTaken} seconds</p>
      <p style="color: #ff9d4d; margin-bottom: 20px;">‚ö†Ô∏è Score not saved to leaderboard (offline mode)</p>
      
      ${analysis.gameInsights ? `<p style="color: #00e5ff; margin-bottom: 20px;">${analysis.gameInsights}</p>` : ''}
      
      ${analysis.strengths.length > 0 ? `
        <div class="analysis-section">
          <h3>üí™ Strengths</h3>
          <ul>
            ${analysis.strengths.map(s => `<li>${s}</li>`).join('')}
          </ul>
        </div>
      ` : ''}
      
      ${analysis.weaknesses.length > 0 ? `
        <div class="analysis-section">
          <h3>üìö Areas for Improvement</h3>
          <ul>
            ${analysis.weaknesses.map(w => `<li>${w}</li>`).join('')}
          </ul>
        </div>
      ` : ''}
      
      ${analysis.recommendations.length > 0 ? `
        <div class="analysis-section">
          <h3>üéØ Recommendations</h3>
          <ul>
            ${analysis.recommendations.map(r => `<li>${r}</li>`).join('')}
          </ul>
        </div>
      ` : ''}
    `;
        showScreen('analysisScreen');
      }
    }

    // Load leaderboard on page load
    if (window.location.hash === '#games') {
      // Auto-show games if coming from link
    }
  </script>

</body>

</html>